<?xml version="1.0" encoding="UTF-8"?>
<job
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="urn:proactive:jobdescriptor:3.7"
     xsi:schemaLocation="urn:proactive:jobdescriptor:3.7 http://www.activeeon.com/public_content/schemas/proactive/jobdescriptor/3.7/schedulerjob.xsd"
    name="Remote_Visualization" projectName="2. Advanced Workflows"
    priority="normal"
    onTaskError="continueJobExecution"
    maxNumberOfExecution="2">
  <taskFlow>
    <task name="Remote_Visualization">
      <pre>
        <script>
          <code language="bash">
            <![CDATA[
echo '#
# $Id: glass.dat,v 1.1 1998/04/15 19:16:41 lhecking Exp $
#
# 16x16 grid Glass shape. Created Using DRAWFN3D, Gershon Elber 1990.
#
  0.568000   0.000000  -0.911000
  0.518894   0.231026  -0.911000
  0.380066   0.422106  -0.911000
  0.175522   0.540200  -0.911000
 -0.059372   0.564888  -0.911000
 -0.284000   0.491902  -0.911000
 -0.459522   0.333862  -0.911000
 -0.555588   0.118094  -0.911000
 -0.555588  -0.118094  -0.911000
 -0.459522  -0.333862  -0.911000
 -0.284000  -0.491902  -0.911000
 -0.059372  -0.564888  -0.911000
  0.175522  -0.540200  -0.911000
  0.380066  -0.422106  -0.911000
  0.518894  -0.231027  -0.911000
  0.568000  -0.000000  -0.911000

  0.341741   0.000000  -0.905215
  0.312196   0.138999  -0.905215
  0.228669   0.253963  -0.905215
  0.105604   0.325015  -0.905215
 -0.035722   0.339869  -0.905215
 -0.170870   0.295956  -0.905215
 -0.276474   0.200870  -0.905215
 -0.334273   0.071052  -0.905215
 -0.334273  -0.071052  -0.905215
 -0.276474  -0.200870  -0.905215
 -0.170871  -0.295956  -0.905215
 -0.035722  -0.339869  -0.905215
  0.105604  -0.325015  -0.905215
  0.228669  -0.253963  -0.905215
  0.312196  -0.138999  -0.905215
  0.341741  -0.000000  -0.905215

  0.212153   0.000000  -0.863178
  0.193812   0.086290  -0.863178
  0.141958   0.157661  -0.863178
  0.065559   0.201770  -0.863178
 -0.022176   0.210991  -0.863178
 -0.106077   0.183730  -0.863178
 -0.171636   0.124701  -0.863178
 -0.207517   0.044109  -0.863178
 -0.207517  -0.044109  -0.863178
 -0.171636  -0.124701  -0.863178
 -0.106077  -0.183730  -0.863178
 -0.022176  -0.210991  -0.863178
  0.065559  -0.201770  -0.863178
  0.141958  -0.157661  -0.863178
  0.193812  -0.086291  -0.863178
  0.212153  -0.000000  -0.863178

  0.138097   0.000000  -0.764660
  0.126157   0.056169  -0.764660
  0.092405   0.102626  -0.764660
  0.042674   0.131338  -0.764660
 -0.014435   0.137340  -0.764660
 -0.069048   0.119595  -0.764660
 -0.111722   0.081171  -0.764660
 -0.135079   0.028712  -0.764660
 -0.135079  -0.028712  -0.764660
 -0.111722  -0.081171  -0.764660
 -0.069048  -0.119595  -0.764660
 -0.014435  -0.137340  -0.764660
  0.042674  -0.131338  -0.764660
  0.092405  -0.102626  -0.764660
  0.126157  -0.056169  -0.764660
  0.138097  -0.000000  -0.764660

  0.098588   0.000000  -0.618872
  0.090065   0.040099  -0.618872
  0.065968   0.073265  -0.618872
  0.030465   0.093763  -0.618872
 -0.010305   0.098048  -0.618872
 -0.049294   0.085380  -0.618872
 -0.079760   0.057949  -0.618872
 -0.096434   0.020498  -0.618872
 -0.096434  -0.020498  -0.618872
 -0.079760  -0.057949  -0.618872
 -0.049294  -0.085380  -0.618872
 -0.010305  -0.098048  -0.618872
  0.030465  -0.093763  -0.618872
  0.065968  -0.073265  -0.618872
  0.090065  -0.040099  -0.618872
  0.098588  -0.000000  -0.618872

  0.084164   0.000000  -0.452254
  0.076887   0.034232  -0.452254
  0.056317   0.062546  -0.452254
  0.026008   0.080044  -0.452254
 -0.008798   0.083703  -0.452254
 -0.042082   0.072888  -0.452254
 -0.068090   0.049470  -0.452254
 -0.082325   0.017499  -0.452254
 -0.082325  -0.017499  -0.452254
 -0.068090  -0.049470  -0.452254
 -0.042082  -0.072888  -0.452254
 -0.008798  -0.083703  -0.452254
  0.026008  -0.080045  -0.452254
  0.056317  -0.062546  -0.452254
  0.076887  -0.034233  -0.452254
  0.084164  -0.000000  -0.452254

  0.092386   0.000000  -0.291706
  0.084399   0.037577  -0.291706
  0.061819   0.068656  -0.291706
  0.028549   0.087865  -0.291706
 -0.009657   0.091880  -0.291706
 -0.046193   0.080009  -0.291706
 -0.074742   0.054303  -0.291706
 -0.090368   0.019208  -0.291706
 -0.090368  -0.019208  -0.291706
 -0.074742  -0.054303  -0.291706
 -0.046193  -0.080009  -0.291706
 -0.009657  -0.091880  -0.291706
  0.028549  -0.087865  -0.291706
  0.061819  -0.068656  -0.291706
  0.084399  -0.037577  -0.291706
  0.092386  -0.000000  -0.291706

  0.124988   0.000000  -0.153861
  0.114183   0.050837  -0.153861
  0.083634   0.092885  -0.153861
  0.038624   0.118871  -0.153861
 -0.013065   0.124304  -0.153861
 -0.062494   0.108243  -0.153861
 -0.101118   0.073466  -0.153861
 -0.122257   0.025987  -0.153861
 -0.122257  -0.025987  -0.153861
 -0.101118  -0.073466  -0.153861
 -0.062494  -0.108243  -0.153861
 -0.013065  -0.124304  -0.153861
  0.038624  -0.118871  -0.153861
  0.083634  -0.092885  -0.153861
  0.114183  -0.050837  -0.153861
  0.124988  -0.000000  -0.153861

  0.185015   0.000000  -0.041791
  0.169020   0.075253  -0.041791
  0.123799   0.137493  -0.041791
  0.057173   0.175960  -0.041791
 -0.019339   0.184002  -0.041791
 -0.092508   0.160228  -0.041791
 -0.149681   0.108749  -0.041791
 -0.180972   0.038467  -0.041791
 -0.180972  -0.038467  -0.041791
 -0.149681  -0.108749  -0.041791
 -0.092508  -0.160228  -0.041791
 -0.019339  -0.184002  -0.041791
  0.057173  -0.175960  -0.041791
  0.123799  -0.137493  -0.041791
  0.169020  -0.075253  -0.041791
  0.185015  -0.000000  -0.041791

  0.273264   0.000000   0.053395
  0.249639   0.111146   0.053395
  0.182849   0.203075   0.053395
  0.084443   0.259889   0.053395
 -0.028564   0.271767   0.053395
 -0.136632   0.236653   0.053395
 -0.221075   0.160620   0.053395
 -0.267292   0.056815   0.053395
 -0.267292  -0.056815   0.053395
 -0.221075  -0.160620   0.053395
 -0.136632  -0.236653   0.053395
 -0.028564  -0.271767   0.053395
  0.084443  -0.259889   0.053395
  0.182849  -0.203075   0.053395
  0.249639  -0.111146   0.053395
  0.273264  -0.000000   0.053395

  0.384384   0.000000   0.149114
  0.351152   0.156343   0.149114
  0.257203   0.285653   0.149114
  0.118781   0.365570   0.149114
 -0.040179   0.382278   0.149114
 -0.192192   0.332886   0.149114
 -0.310973   0.225935   0.149114
 -0.375984   0.079918   0.149114
 -0.375984  -0.079918   0.149114
 -0.310973  -0.225935   0.149114
 -0.192192  -0.332886   0.149114
 -0.040179  -0.382278   0.149114
  0.118781  -0.365571   0.149114
  0.257203  -0.285653   0.149114
  0.351152  -0.156343   0.149114
  0.384384  -0.000000   0.149114

  0.504089   0.000000   0.267473
  0.460508   0.205031   0.267473
  0.337301   0.374611   0.267473
  0.155772   0.479417   0.267473
 -0.052692   0.501327   0.267473
 -0.252044   0.436554   0.267473
 -0.407816   0.296296   0.267473
 -0.493073   0.104806   0.267473
 -0.493073  -0.104806   0.267473
 -0.407816  -0.296296   0.267473
 -0.252044  -0.436554   0.267473
 -0.052692  -0.501327   0.267473
  0.155772  -0.479417   0.267473
  0.337301  -0.374611   0.267473
  0.460508  -0.205031   0.267473
  0.504089  -0.000000   0.267473

  0.609609   0.000000   0.430046
  0.556906   0.247950   0.430046
  0.407908   0.453028   0.430046
  0.188380   0.579773   0.430046
 -0.063721   0.606270   0.430046
 -0.304805   0.527937   0.430046
 -0.493184   0.358319   0.430046
 -0.596288   0.126745   0.430046
 -0.596288  -0.126745   0.430046
 -0.493184  -0.358319   0.430046
 -0.304805  -0.527937   0.430046
 -0.063722  -0.606270   0.430046
  0.188380  -0.579773   0.430046
  0.407908  -0.453028   0.430046
  0.556906  -0.247951   0.430046
  0.609609  -0.000000   0.430046

  0.675154   0.000000   0.647779
  0.616784   0.274610   0.647779
  0.451766   0.501737   0.647779
  0.208634   0.642110   0.647779
 -0.070573   0.671455   0.647779
 -0.337577   0.584700   0.647779
 -0.546211   0.396846   0.647779
 -0.660400   0.140372   0.647779
 -0.660400  -0.140372   0.647779
 -0.546211  -0.396845   0.647779
 -0.337577  -0.584700   0.647779
 -0.070573  -0.671455   0.647779
  0.208634  -0.642110   0.647779
  0.451766  -0.501737   0.647779
  0.616784  -0.274610   0.647779
  0.675154  -0.000000   0.647779

  0.681825   0.000000   0.900691
  0.622878   0.277323   0.900691
  0.456230   0.506695   0.900691
  0.210696   0.648454   0.900691
 -0.071270   0.678090   0.900691
 -0.340913   0.590478   0.900691
 -0.551608   0.400767   0.900691
 -0.666926   0.141760   0.900691
 -0.666926  -0.141759   0.900691
 -0.551608  -0.400767   0.900691
 -0.340913  -0.590478   0.900691
 -0.071270  -0.678090   0.900691
  0.210695  -0.648454   0.900691
  0.456230  -0.506695   0.900691
  0.622878  -0.277324   0.900691
  0.681825  -0.000000   0.900691

  0.626000   0.000000   1.101000
  0.571879   0.254617   1.101000
  0.418876   0.465209   1.101000
  0.193445   0.595361   1.101000
 -0.065435   0.622571   1.101000
 -0.313000   0.542132   1.101000
 -0.506445   0.367954   1.101000
 -0.612320   0.130153   1.101000
 -0.612320  -0.130153   1.101000
 -0.506445  -0.367953   1.101000
 -0.313000  -0.542132   1.101000
 -0.065435  -0.622571   1.101000
  0.193444  -0.595361   1.101000
  0.418876  -0.465209   1.101000
  0.571879  -0.254617   1.101000
0.626000 -0.000000 1.101000'>glass.dat
]]>
          </code>
        </script>
      </pre>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
#!/bin/bash
# Create a X server with Xvnc and run a simple graphical app

Xvnc :10 -geometry 1280x1024 -SecurityTypes None &
xvnc_pid=$!
ps -p $xvnc_pid
if [ $? -eq 0 ]; then
    # magic string to enable remote visualization
    echo "PA_REMOTE_CONNECTION;$variables_PA_JOB_ID;$variables_PA_TASK_ID;vnc;$(hostname):5910"
    export DISPLAY=:10
    # RUN YOUR GUI BASED APPLICATION HERE
    nohup jwm& gnuplot -e 'splot "glass.dat" with lines;  bind "q" "unset output ; exit gnuplot"; pause 120;'

    # To access it, go to the scheduler, enable remote visualization then on the "Tasks" tab, look for the rightmost column called "Visu" and click on the symbol there.

    kill $xvnc_pid
        echo "[debug] Display closed"
        exit
fi
]]>
          </code>
        </script>
      </scriptExecutable>
    </task>
  </taskFlow>
</job>
