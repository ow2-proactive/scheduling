<?xml version="1.0" encoding="UTF-8"?>
<project name="Scheduler" default="compile.all" basedir=".">
	<!--
		Available properties are:
			-Dtest='unitTests/**/*.class'		Override the default testsuite for junit* targets
			-Dversion="3.2.1"					Tag a build with this version
	-->

	<!--
		Create a timestamp for this build 
		If ${version} is defined its value is used as string version for this build
		Otherwise the timestamp is used
	-->

	<!-- ************
		Imports		
	-->

	<property file="${user.home}/.proactive/build.properties" />
	<import file="common.xml" />


	<!-- ************
		Taskdefs		
	-->

	<taskdef name="if" classname="ise.antelope.tasks.IfTask" />

	<!-- ************
		Classpath		
	-->

	<tstamp>
		<format property="TODAY" pattern="yyyy-MM-dd" />
	</tstamp>

	<if name="version">
		<property name="isRelease" value="true" />

		<else>
			<property name="version" value="${TODAY}" />
		</else>
	</if>


	<!-- Default testsuite can be overriden by using the -Dtest property -->
	<if name="test">
		<fileset dir="${cl.rm.tests.dir}" id="rm.testsuite">
				<include name="${test}" />
				<exclude name="**/*$*.class" />
		</fileset>
		<fileset dir="${cl.scheduler.tests.dir}" id="scheduler.testsuite">
			<include name="${test}" />
			<exclude name="**/*$*.class" />
		</fileset>
		<else>
			<fileset dir="${cl.rm.tests.dir}" id="rm.testsuite">
				<include name="**/*Test*.class" />
				<exclude name="**/*$*.class"/>
			</fileset>
			<fileset dir="${cl.scheduler.tests.dir}" id="scheduler.testsuite">
				<include name="**/*Test*.class" />
				<exclude name="**/*$*.class"/>
			</fileset>
		</else>
	</if>		
	
	<!-- ************
		Compilation		
	-->

	<target name="compile.all" depends="compile.common, compile.rm, compile.scheduler" description="Build all class files (Scheduler + Resource Manager)" />

	 <target name="compile.common" description="Compile commmon stuffs">
                <mkdir dir="${cl.common.dir}"/>
	 	
				<copy toDir="${cl.common.dir}">
						<fileset dir="${src.common}" excludes="**/*.java"/>
				</copy>

                <javac
                        srcdir="${src.common}"
                        destdir="${cl.common.dir}"
                        deprecation="on"
                        source="${source}"
                        debug="${debug}"  >

                        <classpath refid="common.libs"/>
                        <include name="**/*.java"/>
                </javac>
        </target>


	<target name="compile.rm" depends="compile.common" description="Compile all Resource Manager stuffs">
		<mkdir dir="${cl.rm.dir}"/>
		<mkdir dir="${cl.rm.tests.dir}"/>
	
		<copy toDir="${cl.rm.dir}">
			<fileset dir="${src.rm.dir}" excludes="**/*.java"/>
		</copy>

		<copy toDir="${cl.rm.tests.dir}">
				<fileset dir="${src.rm.tests.dir}" excludes="**/*.java"/>
				<fileset dir="${cl.rm.tests.dir}" excludes="**/*.java"/>
		</copy>
		
		<javac 
			srcdir="${src.rm.dir}" 
			destdir="${cl.rm.dir}" 
			deprecation="on" 
			source="${source}" 
			debug="${debug}"  >
		
			<classpath refid="rm.libs"/>
			<include name="**/*.java"/>
		</javac>

		<javac 
			srcdir="${src.rm.tests.dir}" 
			destdir="${cl.rm.tests.dir}" 
			deprecation="on" 
			source="${source}" 
			debug="${debug}"  >
		
			<classpath refid="rm.libs"/>
			<classpath path="${cl.rm.dir}"/>
			<include name="**/*.java"/>
		</javac>		
		
		<java classname="${stubgenerator.class}" fork="true">
			<classpath refid="project.classpath" />
			<arg line="-srcDir ${cl.rm.dir} -pkg org.ow2.proactive.resourcemanager" />
		</java>
	</target>

	<target name="compile.scheduler" depends="compile.rm" description="Compile all Scheduler's stuffs">
		<mkdir dir="${cl.scheduler.dir}"/>
		<mkdir dir="${cl.scheduler.tests.dir}"/>

		<copy toDir="${cl.scheduler.dir}">
			<fileset dir="${src.scheduler.dir}" excludes="**/*.java"/>
		</copy>
		<copy toDir="${cl.scheduler.tests.dir}">
				<fileset dir="${src.scheduler.tests.dir}" excludes="**/*.java"/>
		</copy>

		<javac 
			srcdir="${src.scheduler.dir}" 
			destdir="${cl.scheduler.dir}" 
			deprecation="on" 
			source="${source}" 
			debug="${debug}"  >
		
			<classpath refid="scheduler.libs"/>
			<classpath path="${cl.rm.dir}"/>
			<include name="**/*.java"/>
		</javac>

		<javac 
			srcdir="${src.scheduler.tests.dir}"
			destdir="${cl.scheduler.tests.dir}"
			deprecation="on"
			source="${source}"
			debug="${debug}"  >

			<classpath refid="scheduler.libs"/>
			<classpath path="${cl.rm.dir}"/>
			<classpath path="${cl.scheduler.dir}"/>
			<include name="**/*.java"/>
		</javac>
		
		<java classname="${stubgenerator.class}" fork="true">
			<classpath refid="project.classpath" />
            <arg line="-srcDir ${cl.scheduler.dir} -pkg org.ow2.proactive.scheduler" />
		</java>
	</target>

    <!-- ************
		Deploy
	-->
	
	<target name="-deployCopy" >
		<mkdir dir="${deploy.lib.dir}"/>
		<copy todir="${deploy.lib.dir}" flatten="yes">
			<fileset dir="${lib.dir}" includes="**/*.jar"/>
        </copy>
        <copy todir="${deploy.lib.dir}" flatten="no">
            <fileset dir="${lib.dir}/ProActive" includes="**/*.so"/>
            <fileset dir="${lib.dir}/ProActive" includes="**/*.dll"/>
        </copy>
        <copy todir="${deploy.dir}/scripts">
		   <fileset dir="${scripts.dir}"/>
		</copy>
    </target>
	
	<target name="deploy.common" depends="-deployCopy, compile.common" description="Populate Common dist/ with all needed files">
		<jar destfile="${deploy.lib.dir}/${scheduler.common.jar}" index="true">
			<fileset dir="${cl.common.dir}" includes="**" />
			<indexjars>
				<fileset refid="jar.index.fileset" />
			</indexjars>
        </jar>
	</target>

	<target name="deploy.rm" depends="-deployCopy, compile.rm, deploy.common" description="Populate Resourcemanager dist/ with all needed files">
		<jar destfile="${deploy.lib.dir}/${scheduler.rm.jar}" index="true">
			<fileset dir="${cl.rm.dir}" includes="**" />
			<indexjars>
				<fileset refid="jar.index.fileset" />
			</indexjars>
        </jar>
	</target>

	<target name="deploy.scheduler" depends="-deployCopy, deploy.rm, compile.scheduler"  description="Populate Scheduler and Resource Manager dist/ with all needed files">
		<jar destfile="${deploy.lib.dir}/${scheduler.core.jar}" manifest="${basedir}/Manifest-base.mf" index="true">
			<fileset dir="${cl.scheduler.dir}" includes="**" />
			<indexjars>
				<fileset refid="jar.index.fileset" />
			</indexjars>
        </jar>
	</target>

	<target name="deploy.scheduler.client" depends="deploy.scheduler" description="Generate a client side Scheduler library">
		<jar destfile="${deploy.lib.dir}/${scheduler.client.jar}" manifest="${basedir}/Manifest-base.mf" index="true">
				<fileset dir="${cl.scheduler.dir}" includes="org/ow2/proactive/scheduler/common/**" />
				<fileset dir="${cl.scheduler.dir}" includes="org/ow2/proactive/scheduler/resourcemanager/nodesource/policy/**" />
				<fileset dir="${cl.rm.dir}" includes="org/ow2/proactive/resourcemanager/common/*" />
			<indexjars>
				<fileset refid="jar.index.fileset" />
			</indexjars>
	        </jar>
	</target>

	<target name="deploy.all" depends="deploy.common, deploy.scheduler, deploy.rm, deploy.scheduler.client, deploy.scheduler.worker" description="Populate Scheduler and Resource Manager dist/ with all needed files (same as deploy.scheduler)"/>


	<!-- ************
		ing
	-->

	<macrodef name="junitMacro">
		<attribute name="testsuite"/>
		<element name="jvmargs" optional="yes" />
		<element name="additionalClasspath" optional="yes" />
		<sequential>

			<mkdir dir="${junit.dir}" />
			<junit printsummary="yes" forkmode="perTest" showoutput="${junit.showoutput}">
				<jvmarg value="-Dproactive.home=${base.dir}" />
				<jvmarg value="-Dpa.scheduler.home=${base.dir}" />
				<jvmarg value="-Dpa.rm.home=${base.dir}" />
				<classpath>
					<additionalClasspath />
					<path refid="test.classpath" />
				</classpath>

				<jvmarg value="-Djava.security.policy=${base.dir}/compile/proactive.java.policy" />
				<jvmarg value="-Dlog4j.configuration=file:${base.dir}/compile/scheduler-log4j" />
				<jvmarg value="-Dproactive.http.jetty.xml=${base.dir}/config/deployment/jetty.xml"/>
				<jvmargs />

				<!--
					Remote Debug:
					<jvmarg value="-Xdebug" />
					<jvmarg value="-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8000" />

					Yourkit (don't forget to set your LD_LIBRARY_PATH):
					<jvmarg value="-agentlib:yjpagent" />
				-->

				<formatter type="xml" />


				<batchtest fork="yes" todir="${junit.dir}">
					<fileset refid="@{testsuite}" />
				</batchtest>
			</junit>
		</sequential>
	</macrodef>

	<target name="junit.rm" depends="deploy.rm" description="Run resource manager's tests">
		<junitMacro testsuite="rm.testsuite"/>
	</target>

	<target name="junit.scheduler" depends="deploy.scheduler.worker" description="Run scheduler's tests">
		<junitMacro testsuite="scheduler.testsuite"/>
	</target>

	<target name="junit.all" depends="junit.rm, junit.scheduler" description="Run all tests"/>

	<target name="with.clover">
		<taskdef resource="cloverlib.xml" classpath="${base.dir}/compile/lib/clover.jar" />
		<clover-setup initString="${compile.dir}/ProActiveCoverage.db" />
	</target>


	<target name="clover.report" depends="with.clover">
		<taskdef resource="cloverlib.xml" classpath="${base.dir}/compile/lib/clover.jar" />
		<!-- generate a historypoint for the current coverage -->
		<clover-historypoint historyDir="${clover.historypoint.dir}" />
		<clover-report>
			<!-- generate a current report -->
			<current title="ProActive_Scheduler" outfile="${clover.report.dir}">
				<testresults dir="${junit.dir}" includes="TEST-*.xml" />
				<format type="html" />
				<fileset dir="${src.dir}">
					<include name="scheduler/src/**/*.java" />
					<include name="scheduler/tests/**/*.java" />
					<include name="resource-manager/src/**/*.java" />
					<include name="resource-manager/tests/**/*.java" />
				</fileset>
				<sourcepath>
					<dirset dir="${src.dir}">
						<include name="scheduler/src" />
						<include name="resource-manager/src" />
					</dirset>
				</sourcepath>
			</current>
			<!-- generate a historical report -->
			<historical outfile="${clover.historyreport.dir}" historyDir="${clover.historypoint.dir}">
				<format type="html" />
			</historical>
		</clover-report>
		<!--
		<clover-clean />
-->
	</target>

	<target name="junit.clover" depends="with.clover, clean, deploy.all" description="Run all tests with code coverage (type: 'build junit.clover clover.report')">
		<copy file="${compile.dir}/lib/clover.jar" todir="${deploy.lib.dir}"/>
		<!-- copy all RM tests file to scheduler test directory in order
		 to have one fileset for clover
		( We can define one fileset and include cl.rm.tests.dir and cl.rm.tests.dir,
		but cl.rm.tests.dir and cl.rm.tests.dir will prefix  package names :(-->
		<copy todir="${cl.scheduler.tests.dir}">
				<fileset dir="${cl.rm.tests.dir}"/>
			</copy>
		<junitMacro testsuite="scheduler.testsuite">
			<additionalClassPath>
				<pathelement location="${ant.home}/lib/clover.jar" />
			</additionalClassPath>
		</junitMacro>
	</target>

	<macrodef name="eclipse_format_m">
		<attribute name="loglevel" default="WARN" />
		<element name="sourcefileset" optional="false" />

		<sequential>
			<taskdef name="javaformatter" classname="org.hibernate.tool.ant.JavaFormatterTask">
				<classpath>
					<fileset dir="${dev.dir}/lib">
						<include name="*.jar" />
					</fileset>
				</classpath>
			</taskdef>

			<copy file="${compile.dir}/eclipse_formatter_config.xml" tofile="${compile.dir}/eclipse_formatter_config.properties" />

			<replaceregexp file="${compile.dir}/eclipse_formatter_config.properties" match='^&lt;(.xml|/?profile).*' replace="" byline="true" />

			<replaceregexp file="${compile.dir}/eclipse_formatter_config.properties" match='.*\"(.*)\".*\"(.*)\".*' replace="\1=\2" byline="true" />

			<javaformatter configurationFile="eclipse_formatter_config.properties">
				<sourcefileset />
			</javaformatter>
		</sequential>
	</macrodef>

	<target name="format" description="hibernate's eclipse-based source code formatter">
		<eclipse_format_m>
			<sourcefileset>
				<fileset dir="${src.common}" includes="**/*.java" />
				<fileset dir="${src.scheduler.dir}" includes="**/*.java" />
				<fileset dir="${src.scheduler.tests.dir}" includes="**/*.java" />
				<fileset dir="${src.rm.dir}" includes="**/*.java" />
				<fileset dir="${src.rm.tests.dir}" includes="**/*.java" />
				<fileset dir="${rcp.plugins.dir}" includes="**/*.java" />
			</sourcefileset>
		</eclipse_format_m>
	</target>

	<!-- ************
		Misc
	-->

	<target name="clean" description="Remove all generated files">
		<delete dir="${classes.dir}" />
		<delete dir="${release.dir}" />
		<delete dir="${deploy.dir}" />
		<delete dir="${classlibs.dir}" />
		<delete dir="${test.classes.dir}" />
		<delete file="tests.log" />
		<delete dir="${junit.dir}" />
		<!-- Database generated classes -->
		<delete file="${base.dir}/.logs/derby.log" />
		<subant target="doc.clean" inheritall="true">
			<fileset dir="../doc/toolchain" includes="doc.xml"/>
		</subant>
	</target>


	<target name="-init">
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${classes.dir}" />
		<mkdir dir="${cl.examples.dir}" />
		<mkdir dir="${cl.extra.dir}" />
		<mkdir dir="${cl.extensions.dir}" />
		<mkdir dir="${cl.proactive.dir}" />
		<mkdir dir="${cl.test.dir}" />
		<mkdir dir="${cl.utils.dir}" />
		<mkdir dir="${cl.benchmarks.dir}" />

		<echo message="--- Debugging is ${debug} ---" />
	</target>


	<target name="-configurationCopy" depends="-init">
		<copy toDir="${cl.proactive.dir}">
			<fileset dir="${src.proactive.dir}">
				<include name="org/objectweb/proactive/core/config/proactive-log4j" />
				<include name="org/**/*.xml" />
				<include name="org/**/*.fractal" />
				<include name="org/**/*.properties" />
				<include name="org/**/*.xsd" />
				<include name="org/**/*.png" />
				<include name="org/objectweb/proactive/core/component/adl/xml/proactive.dtd" />
				<include name="common/**/jaas.config" />
			</fileset>
		</copy>
	</target>

	<target name="scheduler.libClean" description="Clean all required libraries for scheduler/rm plugins">
		<delete dir="${rcp.plugins.dir}/${scheduler.plugin.lib}/lib" />
	</target>

	<target name="scheduler.libCopy" depends="deploy.all" description="Copy all required libraries to scheduler/rm plugins">
		<copy todir="${rcp.plugins.dir}/${scheduler.plugin.lib}/lib" includeemptydirs="no">
			<fileset dir="${deploy.lib.dir}" excludes="ProActive_tests.jar"/><!--,${scheduler.core.jar}, ${scheduler.worker.jar}-->
		</copy>
	</target>

	<!-- ================================================================ -->
	<!--  Scheduler Specific - Convert Schemas from Relax NG to XMLSchema -->
	<!-- ================================================================ -->
	<target name="convertSchemas" description="convert Schemas from Relax NG Compact Syntax to Relax NG XML Syntax and to XMLSchema inside the scheduler.">
		<taskdef name="trang" classname="net.amadan.trang.ant.TrangTask">
			<classpath>
				<fileset dir="${base.dir}/dev/lib/trang">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</taskdef>

		<property name="schemas.dir" value="${src.scheduler.dir}/${scheduler.path}/common/xml/schemas/jobdescriptor/1.0" />
		<property name="export.schema.name" value="schedulerjob" />

		<!-- Convert Relax NG schema from compact syntax to xml syntax -->
		<trang failonerror="true" input="${schemas.dir}/${export.schema.name}.rnc" output="${schemas.dir}/${export.schema.name}.rng" />

		<!-- Convert Relax NG schema from compact syntax to W3C Schema -->
		<trang failonerror="true" input="${schemas.dir}/${export.schema.name}.rnc" output="${schemas.dir}/${export.schema.name}.xsd" />
		<xslt style="${base.dir}/dev/lib/trang/removeStuff.xsl" in="${schemas.dir}/${export.schema.name}.xsd" out="${schemas.dir}/temp.xsd" />
		<delete>
			<fileset dir="${schemas.dir}/">
				<include name="xsi.xsd" />
				<include name="${export.schema.name}.xsd" />
			</fileset>
		</delete>
		<move file="${schemas.dir}/temp.xsd" tofile="${schemas.dir}/${export.schema.name}.xsd" />
	</target>

	<import file="../doc/scheduler.xml" optional="true"/>

	<!-- last scheduler target for worker library -->
	<target name="deploy.scheduler.worker" depends="deploy.scheduler" description="Generate a worker side Scheduler library">
		<mkdir dir="${cl.scheduler.worker.dir}"/>

		<!-- create TMP dir to put worker classes in -->
		<property name="worker.dir.tmp" value="${cl.scheduler.dir}/tmpworkersrc" />
		<mkdir dir="${worker.dir.tmp}"/>
		<!-- copy worker file in this dir -->
        <copy toDir="${worker.dir.tmp}">
			<fileset dir="${src.scheduler.dir}">
				<!-- Use to point every classes that have to be in the worker side library -->
				<include name="org/ow2/proactive/scheduler/job/JobIdImpl.java" />
				<include name="org/ow2/proactive/scheduler/exception/RunningProcessException.java" />
				<include name="org/ow2/proactive/scheduler/exception/StartProcessException.java" />
				<include name="org/ow2/proactive/scheduler/exception/AdminSchedulerException.java" />
				<include name="org/ow2/proactive/scheduler/exception/DataBaseNotFoundException.java" />
				<include name="org/ow2/proactive/scheduler/exception/ProcessException.java" />
				<include name="org/ow2/proactive/scheduler/exception/AdminException.java" />
				<include name="org/ow2/proactive/scheduler/task/TaskResultImpl.java" />
				<include name="org/ow2/proactive/scheduler/task/TaskIdImpl.java" />
				<include name="org/ow2/proactive/scheduler/task/NativeExecutable.java" />
				<include name="org/ow2/proactive/scheduler/task/ExecutableContainer.java" />
				<include name="org/ow2/proactive/scheduler/task/launcher/JavaTaskLauncher.java" />
				<include name="org/ow2/proactive/scheduler/task/launcher/ForkedJavaTaskLauncher.java" />
				<include name="org/ow2/proactive/scheduler/task/launcher/NativeTaskLauncher.java" />
				<include name="org/ow2/proactive/scheduler/task/launcher/TaskLauncher.java" />
				<include name="org/ow2/proactive/scheduler/task/launcher/ProActiveTaskLauncher.java" />
				<include name="org/ow2/proactive/scheduler/task/launcher/TaskLauncherInitializer.java" />
				<include name="org/ow2/proactive/scheduler/task/ExecutableContainerInitializer.java" />
				<include name="org/ow2/proactive/scheduler/task/JavaExecutableContainer.java" />
				<include name="org/ow2/proactive/scheduler/task/ForkedJavaExecutable.java" />
				<include name="org/ow2/proactive/scheduler/task/KillTask.java" />
				<include name="org/ow2/proactive/scheduler/task/NativeExecutableContainer.java" />
				<include name="org/ow2/proactive/scheduler/core/properties/PASchedulerProperties.java" />
				<include name="org/ow2/proactive/scheduler/util/SchedulerDevLoggers.java" />
				<include name="org/ow2/proactive/scheduler/util/process/EnvVars.java" />
				<include name="org/ow2/proactive/scheduler/util/process/CaseInsensitiveComparator.java" />
				<include name="org/ow2/proactive/scheduler/util/process/ThreadReader.java" />
				<include name="org/ow2/proactive/scheduler/util/process/ProcessTreeKiller.java" />
				<include name="org/ow2/proactive/scheduler/common/Main.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/appenders/AsyncAppenderWithStorage.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/appenders/EmptyAppender.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/appenders/SocketAppenderWithSSHTunneling.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/providers/ProActiveBasedForwardingProvider.java"/>
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/providers/SocketBasedForwardingProvider.java"/>
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/providers/SocketWithSSHTunnelBasedForwardingProvider.java"/>
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/util/LoggingOutputStream.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/util/SimpleLoggerServer.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/AppenderProvider.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/LogForwardingException.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/LogForwardingProvider.java" />
				<include name="org/ow2/proactive/scheduler/common/util/logforwarder/LogForwardingService.java" />
				<include name="org/ow2/proactive/scheduler/util/classloading/TaskClassServer.java" />
				<include name="org/ow2/proactive/scheduler/util/classloading/TaskClassLoader.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobPriority.java" />
				<include name="org/ow2/proactive/scheduler/common/job/TaskFlowJob.java" />
				<include name="org/ow2/proactive/scheduler/common/job/ProActiveJob.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobResult.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobEnvironment.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobType.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobInfo.java" />
				<include name="org/ow2/proactive/scheduler/common/job/Job.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobId.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobStatus.java" />
				<include name="org/ow2/proactive/scheduler/common/job/JobState.java" />
				<include name="org/ow2/proactive/scheduler/common/db/annotation/Alterable.java" />
				<include name="org/ow2/proactive/scheduler/common/db/annotation/Unloadable.java" />
				<include name="org/ow2/proactive/scheduler/common/exception/UserException.java" />
				<include name="org/ow2/proactive/scheduler/common/exception/DependenceFailedException.java" />
				<include name="org/ow2/proactive/scheduler/common/exception/ExecutableCreationException.java" />
				<include name="org/ow2/proactive/scheduler/common/exception/SchedulerException.java" />
				<include name="org/ow2/proactive/scheduler/common/exception/MaxJobIdReachedException.java" />
				<include name="org/ow2/proactive/scheduler/common/SchedulerConstants.java" />
				<include name="org/ow2/proactive/scheduler/common/task/RestartMode.java" />
				<include name="org/ow2/proactive/scheduler/common/task/TaskDescriptor.java" />
				<include name="org/ow2/proactive/scheduler/common/task/JavaTask.java" />
				<include name="org/ow2/proactive/scheduler/common/task/ForkEnvironment.java" />
				<include name="org/ow2/proactive/scheduler/common/task/TaskLogs.java" />
				<include name="org/ow2/proactive/scheduler/common/task/NativeTask.java" />
				<include name="org/ow2/proactive/scheduler/common/task/util/BooleanWrapper.java" />
				<include name="org/ow2/proactive/scheduler/common/task/util/IntegerWrapper.java" />
				<include name="org/ow2/proactive/scheduler/common/task/util/ResultPreviewTool.java" />
				<include name="org/ow2/proactive/scheduler/common/task/util/BigString.java" />
				<include name="org/ow2/proactive/scheduler/common/task/UpdatableProperties.java" />
				<include name="org/ow2/proactive/scheduler/common/task/ResultPreview.java" />
				<include name="org/ow2/proactive/scheduler/common/task/TaskInfo.java" />
				<include name="org/ow2/proactive/scheduler/common/task/TaskState.java" />
				<include name="org/ow2/proactive/scheduler/common/task/ProActiveTask.java" />
				<include name="org/ow2/proactive/scheduler/common/task/Log4JTaskLogs.java" />
				<include name="org/ow2/proactive/scheduler/common/task/TaskId.java" />
				<include name="org/ow2/proactive/scheduler/common/task/Task.java" />
				<include name="org/ow2/proactive/scheduler/common/task/SimpleTaskLogs.java" />
				<include name="org/ow2/proactive/scheduler/common/task/TaskResult.java" />
				<include name="org/ow2/proactive/scheduler/common/task/executable/Executable.java" />
				<include name="org/ow2/proactive/scheduler/common/task/executable/ProActiveExecutable.java" />
				<include name="org/ow2/proactive/scheduler/common/task/executable/JavaExecutable.java" />
				<include name="org/ow2/proactive/scheduler/common/task/CommonAttribute.java" />
				<include name="org/ow2/proactive/scheduler/common/task/TaskStatus.java" />
				<include name="org/ow2/proactive/scheduler/common/util/Tools.java" />
				<include name="org/ow2/proactive/scheduler/common/util/SchedulerLoggers.java" />
				<include name="org/ow2/proactive/scheduler/common/util/JarUtils.java" />
				<include name="org/ow2/proactive/scheduler/common/util/SimpleLoggerServer.java" />
				<include name="org/ow2/proactive/scheduler/common/util/RegexpMatcher.java" />
				<include name="org/ow2/proactive/scheduler/common/TaskTerminateNotification.java" />
				<include name="org/ow2/proactive/scheduler/examples/PropertyTask.java" />
				<include name="org/ow2/proactive/scheduler/examples/NativeTestWithRandomDefault.java" />
				<include name="org/ow2/proactive/scheduler/examples/MonteCarlo.java" />
				<include name="org/ow2/proactive/scheduler/examples/JoinPreview.java" />
				<include name="org/ow2/proactive/scheduler/examples/KillJob.java" />
				<include name="org/ow2/proactive/scheduler/examples/MonteCarloAverage.java" />
				<include name="org/ow2/proactive/scheduler/examples/ProActiveExample.java" />
				<include name="org/ow2/proactive/scheduler/examples/WaitAndPrint.java" />
				<include name="org/ow2/proactive/scheduler/examples/DenoisePreview.java" />
				<include name="org/ow2/proactive/scheduler/examples/AbortJob.java" />
				<include name="org/ow2/proactive/scheduler/examples/Worker.java" />
	            <include name="org/ow2/proactive/scheduler/util/Shell.java"/>
	            <include name="org/ow2/proactive/scheduler/util/LinuxShellExecuter.java"/>
	            <include name="org/ow2/proactive/scheduler/ext/common/util/*.java"/>
	            <include name="org/ow2/proactive/scheduler/ext/matlab/*.java"/>
	            <include name="org/ow2/proactive/scheduler/ext/matlab/exception/*.java"/>
	            <include name="org/ow2/proactive/scheduler/ext/matlab/util/*.java"/>
	            <include name="org/ow2/proactive/scheduler/ext/scilab/*.java"/>
	            <include name="org/ow2/proactive/scheduler/ext/scilab/exception/*.java"/>
	            <include name="org/ow2/proactive/scheduler/ext/scilab/util/*.java"/>
				<include name="org/ow2/proactive/scheduler/ext/**/*.sh"/>
                <include name="org/ow2/proactive/scheduler/ext/**/*.bat"/>
			</fileset>
		</copy>

		<javac  srcdir="${worker.dir.tmp}"
						destdir="${cl.scheduler.worker.dir}"
						deprecation="on"
						source="${source}"
						debug="${debug}"
						classpathref="scheduler.libs.worker" >
		</javac>

        <copy toDir="${cl.scheduler.worker.dir}">
			<fileset dir="${worker.dir.tmp}">
				<include name="org/ow2/proactive/scheduler/ext/**/*.sh"/>
                <include name="org/ow2/proactive/scheduler/ext/**/*.bat"/>
			</fileset>
		</copy>

		<jar destfile="${deploy.lib.dir}/${scheduler.worker.jar}"  manifest="${basedir}/Manifest-base.mf" index="true">
			<fileset dir="${cl.scheduler.worker.dir}" includes="**"/>
            <indexjars>
				<fileset refid="jar.index.fileset" />
			</indexjars>
        </jar>

		<delete dir="${worker.dir.tmp}" />
		<delete dir="${cl.scheduler.worker.dir}" />
	</target>

	<target name="update_copyright_and_version" description="Update Copyright and Version in every text files">
		<java classname="sources.UpdateCopyrightAndVersion" fork="false">
			<classpath path="${lib.dir}/ProActive/ProActive_utils.jar" />
			<!--  base dir -->
			<arg value="${base.dir}" />
			<!--  exclude dirs -->
			<arg value="${docs.dir}" />
			<arg value="${dist.dir}" />
			<arg value="${classes.dir}" />
			<arg value="${test.classes.dir}" />
			<arg value="${lib.dir}" />
			<arg value="${dev.dir}" />
			<arg value="${extra.format.dir}"/>
		<sysproperty key="copyright.update" value="${copyright.update}"/>
		</java>
	</target>

</project>
